<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <style>
        video, #cssfilters-video, #screenshot-img {
            width: 400px;
            height: 300px;
        }
        video, #cssfilters-stream {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid #ccc;
        }
    </style>

</head>
<body>

<div id="screenshot" style="text-align:center;">
    <video class="videostream" autoplay></video>
    <img id="screenshot-img">
    <p><button class="capture-button">Capture video</button>
    <p><button id="screenshot-button" disabled>Take screenshot</button></p>
    <p><button id="stop-button" disabled>Stop</button></div></p>
</div>
<script>
    function handleError(error) {
        console.error('navigator.getUserMedia error: ', error);
    }
    var constraints = {video: true};

    (function() {
        var captureVideoButton = document.querySelector('#screenshot .capture-button');
        var screenshotButton = document.querySelector('#screenshot-button');
        var stopButton = document.querySelector('#stop-button');
        var img = document.querySelector('#screenshot img');
        var video = document.querySelector('#screenshot video');
        var localMediaStream;

        var canvas = document.createElement('canvas');

        captureVideoButton.onclick = function() {
            navigator.mediaDevices.getUserMedia(constraints).
            then(handleSuccess).catch(handleError);
        };

        screenshotButton.onclick = video.onclick = function() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            // Other browsers will fall back to image/png
            img.src = canvas.toDataURL('image/webp');
        };

        document.querySelector('#stop-button').onclick = function() {
            video.pause();
            localMediaStream.stop();
        };

        function handleSuccess(stream) {
            stopButton.disabled = false;
            screenshotButton.disabled = false;
            video.srcObject = stream;
            localMediaStream = stream;
        }
    })();
</script>
</body>
</html>
